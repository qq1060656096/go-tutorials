# 怎么避免程序重复的代码和接口

```
1. 什么是重复代码
2. 重复代码的危害
    2.1.重复会降低你的代码质量
    2.2.在重复代码上开发需求和修复 bug 时带来很大的风险
    2.3.增加安全风险
3. 重复代码产生的原因
4. 怎么检查重复的代码
5. 怎么避免重复代码
6. 什么时候可以忽略重复代码
```

## 1. 什么是重复代码
```
重复代码是在同一文件中或有时在同一本地环境中重复一行或一段代码。人们可能认为代码重复是可以接受的，但实际上，它给您的软件带来的问题比您想象的要大。甚至具有相似功能的代码也被称为重复。
```

## 2. 重复代码的危害
```
2.1.重复会降低你的代码质量
2.2.在重复代码上开发需求和修复 bug 时带来很大的风险
2.3.增加安全风险
```

### 2.1 重复会降低你的代码质量
```
如果我们的软件生命周期很短（只要你打算很快扔掉你的软件，复制是可以的）。
代码质量是软件长期生存的必要条件。
重复代码会降低了可读性，让代码变得很臭，并增加与之相关的技术债务。
修复这种债务的成本是向开发人员支付的资金和时间，以简化或重复。
我们感兴趣的是开发人员生产力的下降。

有时重构重复的代码块是不可能的，但是我们应该尽可能减少技术债务。它有助于提高代码的质量。
```

### 2.3.在重复代码上开发需求和修复 bug 时带来很大的风险
```
没有重复的情况：当我们编写了错误的代码。在进行代码审查以找出问题，然后修复它。
现在用重复代码很多（有6-7份），当在重复代码上开发需求和修复 bug 时。我们现在必须修改或者修复代码所在的每个位置，
从而浪费我们的时间、效率，有时甚至是脾气。这种情况对于任何程序员来说都是非常讨厌的。
```

### 2.4.增加安全风险
```
这更像是一个复制和粘贴编程问题，而不是重复代码。
但就像大多数时候通过使用复制粘贴过程产生重复代码一样，它值得一提。
当有人从某个地方获取代码并添加到他们的软件中时，他们会忘记抄袭代码的漏洞和结局。
重复的代码为攻击者留下了漏洞利用并进入您的代码，使其易受攻击。
```

## 3. 重复代码产生的原因
```
1.创建重复代码的主要原因是复制和粘贴编程
    有时候为了快，为了省事。没有考虑后续更变带来的风险和成本。
    例如新增需求和bug变得越来越耗时和困难
    
1. 有意的重复：开发者觉得他们无可选择--环境似乎要求重复
    有时候为了性能
2. 无意的重复：开发者没有意识到他们在重复信息
    在开发时根本没有意识到，开发时如果一个段代码出现了2次，就应该抽出来，防止重复。
3. 无奈的重复：开发者偷懒，他们重复，因为那样似乎更容易（觉得时间太紧迫，改动很困难）
    开发时开发者偷懒，他们重复，因为那样似乎更容易，出问题，或者改 bug 往往只改了一个地方，导致额外的技术债务。
4. 开发者之间的重复：同一团队（或不同团队）的几个人重复了同样的信息
    代码太分散，不知道其他人写过类似的代码。


现在网上代码参差不齐，很多示例代码都是出于学术目的而不是为了商业开发而制作的，因此它们包含冗余数据，以便程序易于理解。
避免使用未经过验证的代码
```

## 4. 怎么检查重复的代码
```
我们已经确信重复代码对的软件有害。但是如何检查软件是否有重复代码？
毕竟，它由多个文件和每个文件中的 300 行代码组成。逐行遍历听起来不是一个可行的解决方案，除非它只是一个包含几行代码的文件。
这是自动化工具派上用场的地方，通过使用 IDE自带、sonar 等代码审查工具，无论文件数量或代码行数如何，您都可以很快的找到重复项。
不仅显示重复百分比，还显示它所在的文件及其行号以及重复代码块的文件路径和行号。除了重复之外，还显示了错误、代码气味安全漏洞和代码库的代码覆盖率。
```

## 5. 怎么避免重复代码
```
1. 观念上的转变，因为我们是代码的开发和维护者，重复的代码意味着给自己制造麻烦
2. 开发时如果一个段代码出现了2次，就应该抽出来，防止重复。
3. 避免复制和粘贴编程
4. 在开发时使用 IDE自带、sonar等代码审查工具帮助我们重复的代码。
5. 在 git 提交时检查代码重复
```


## 6. 什么时候可以忽略重复代码
```
1. 如果我们的软件生命周期很短（只要你打算很快扔掉你的软件，复制是可以的）。
2. 我们只是为了演示一个代码段，或者做学术研究

在极少数情况下，您希望忽略重复代码。
建议将重复代码百分比保持在最低水平。每家公司都有自己的复制百分比阈值，以符合其质量标准。
0% 的重复是非常困难的，并且随着源代码文件数量的增加而变得更加困难。
最重要的是遵循适当的编码标准，如 DRY，并建立有效的代码审查流程。
及时进行代码审查很重要，以免以后增加技术债务。即使您将项目外包，您也需要检查重复项，因为最终维护和更新软件是您的责任。
```
