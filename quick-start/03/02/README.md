# API 设计
> API 的本质是保证使用者以较低的成本，正确的使用接口完成业务。

```
什么是好的 API
1. 容易理解和记忆（命名一定要和场景相关）
2. 保持与普遍认知一致的设计
3. 容易测试
4. 保证兼容性
```

## 1. 容易理解和记忆（命名一定要和场景相关）

```
示例：我们有一个订单报表内网接口，最初只需要过滤指定的订单业务员。随着需求的需要，因为有些客户是多个业务，要求同时可以过滤订单业务员和客户的业务员
    最初我们采用的是 staff_id，后面接口新增了一个可选字段 客户的业务员 client_staff_id。由于人员流动或者 staff_id 的乱用。
    导致不知道 staff_id 的具体意思（有的地方是登录 staff_id，有的地方是客户主业务，还有的是订单业务员）
    所以我们命名一定要和场景相关 search_order_staff_id、search_client_staff_id、login_staff_id
   优化后命名：
    搜索订单员工：search_order_staff_id
    搜索客户业务业务员：search_client_staff_id
    登录员工：login_staff_id

结论：
  1. 命名不清楚，导致了额外的 bug
  2. 命名不清楚，导致了被滥用
  3. 命名不清楚，使用接口的时候无法立马知道准确的意思，增加了理解和沟通成本
    
```

## 2. 保持与普遍认知一致的设计
```
作为 API 的设计者，不能假定使用者都会认真的看完所有的文档，所以尽量做到以下两点：
  保持与普遍认知一致的设计
  保持设计概念上的一致性
也就是说那些被公认的行为和命名非常重要，千万不要做太多的创新。请遵守最小惊喜原则。

不一致场景
  1. 接口返回结构千奇百怪。
  2. 接口返回字段 A，一会是字符类型一会是整形。
  3. 接口请求参数一会是下划线命名，一会是小驼峰。
```

## 3. 容易测试
```
1. 比如接口新增资源接口，没有返回 ID，导致没法自动化测试
2. 比如接口返回结构不一致
```

## 4. 保证兼容性

```
1. 向后兼容(非破坏性)的修改
   1. 添加新的接口
        从协议的角度来看，这始终是安全的。
   2. 接口中添加方法，除非方法和现有的接口有冲突，否则这种修改没有任何问题
   3. 接口添加可选请求字段（或者说可选请求字段）
        在新版和旧版中对该字段的处理保持一致，添加请求字段就是兼容的。
   4. 接口响应添加返回字段
        在不改变其他响应字段的行为的前提下，添加返回字段就是兼容的。
2. 向后不兼容(破坏性)的修改
  1. 删除或重命名服务，字段，方法或枚举值
        从根本上看，如果客户端代码可能引用某些内容，对其执行移除或重命名操作就是重大更改，可能导致客户端奔溃，或者逻辑问题。
        所以我们不建议删除和重名命名操作。
  2. 修改请求字段和返回字段的类型
        即使新类型与传输格式兼容，我们也不建议。
  3. 修改现有请求的可见行为
        
```
